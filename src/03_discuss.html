<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="./images/index/webIcon.png" type="image/x-icon" />
    <link rel="stylesheet" href="css/discuss.css" />
    <title>找茶討論</title>
</head>

<body>
    @@include('layout/leaf.html')
    @@include('layout/nav.html')
    <main id="are">
        <div class="banner">
            <div>
                <h1>找茶討論</h1>
            </div>
        </div>
        <button class="addtour">
            <a href="03_discuss_pub.html">我要發文
            </a>
            <img class="dis_hand_pub" src="./images/discuss/hand_button.png" alt="">
        </button>
        <section id="articles">
            <ul id="discuss_filter">
                <li class="list fit cate all" data-filter="all">全部</li>
                <li class="list cate tour" data-filter="tour">揪團心得</li>
                <li class="list cate garden" data-filter="garden">茶園討論</li>
                <li class="list cate leaf" data-filter="leaf">茶葉知識</li>
            </ul>
        </section>

        <section id="discuss">
            <div id="all_articles">
                <!-- =====單篇文章開始===== -->
                <div v-for="(artRow,i) in articlesRows" class="article" :class="artRow.FILTER">
                    <div class="ar_img">
                        <img class="ar_rimg" :src="artRow.ART_IMG" alt="">
                        <p class="ar_title">【{{artRow.CAT}}】{{artRow.ART_TITLE}}</p>
                        <div class="art_memicon">
                            <img class="memi memipeople" :src=" artRow.MEM_IMG " alt="">
                            <span class="mem_name">{{artRow.MEM_NICNAME}}</span>
                        </div>
                    </div>
                    <div class="ar_text">
                        <div class="art_icons">
                            <img class="memi addheart" title="add" src="./images/common/heart.png" alt=""
                                @click="addheart(artRow.ART_NO)">
                            <img class="memi" src="./images/common/messenger.png" alt="">
                            <span class="com_num">{{artRow.ART_REPLYS}}</span>
                            <div class="excl" @click="showBox(artRow.ART_NO)">
                                <img class="excl" src="./images/common/852019_exclamation_512x512.png" alt="">
                            </div>
                        </div>
                        <div class="ar_innertext">
                            <p>{{artRow.ART_CONTENT}}</p>
                        </div>
                        <div class="btncontainer"><button class="btn">
                                <a :href="'03_discuss_article.php?ART_NO=' + artRow.ART_NO">More</a></button>
                        </div>
                        <div class="pub_time"><span>發表於{{artRow.ART_DATE}}</span></div>
                    </div>
                </div>
                <!-- ====檢舉燈箱==== -->
            </div>
        </section>
        <art-reg :artno="artno"></art-reg>
    </main>
    @@include('layout/footer.html')
    <!-- vue  -->
    <script src="./js/vue.js"></script>

    <!-- ====臉書分享==== -->
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v9.0"
        nonce="02xnpbCX"></script>



    <script>
        Vue.component('art-reg', {
            props: ['artno'],
            template: ` <div><div class="overlay" style="display: none;">
                            <div class="modal">
                                <form method="post" >
                                    <div class="close" @click="closeBox()">
                                        <img class="cancel" src="./images/vote/cancel.png">
                                    </div>
                                    <p class="welcome">請選取檢舉理由</p>
                                    <div class="reason_container">
                                        <input class="reason" type="radio" name="size" id="a" value="惡意中傷">
                                        <label for="a">惡意中傷</label>
                                    </div>
                                    <div class="reason_container">
                                        <input class="reason" type="radio" name="size" id="b" value="散布廣告">
                                        <label for="b">散布廣告</label>
                                    </div>
                                    <div class="reason_container">
                                        <input class="reason" type="radio" name="size" id="c" value="色情資訊">
                                        <label for="c">色情資訊</label>
                                    </div>
                                    <div class="reason_container">
                                        <input class="reason" type="radio" name="size" id="d" value="不雅字眼">
                                        <label for="d">不雅字眼</label>
                                    </div>
                                    <button class="go" type="button" @click="send_data">送出</button>
                                    <input type="hidden" name="art_reg" :value="artno">
                                </form>
                            </div>
                         </div>
                         <div class="overlay2" style="display: none;" >
                            <div class="modal">
                                <form method="post" >
                                    <p class="welcome">檢舉成功！</p>
                                    <button class="go" type="button" @click="close">確認</button>
                                </form>
                            </div>
                         </div></div>
                         `,


            methods: {
                closeBox: function () {
                    let lightbox = document.querySelectorAll('.overlay')[0];
                    lightbox.style.display = 'none';
                },
                check_radio() {

                },
                send_data() {
                    $.ajax({
                        url: './phps/articleReg.php', // 要傳送的頁面
                        method: 'POST',               // 使用 POST 方法傳送請求
                        dataType: 'text',             // 回傳資料會是 json 格式
                        data: $('form').serialize(),  // 將表單資料用打包起來送出去
                        success: function (res) {       // 成功以後會執行這個方法
                            console.log('good');
                            let lightbox = document.querySelectorAll('.overlay')[0];
                            lightbox.style.display = 'none';
                            let lightbox2 = document.querySelectorAll('.overlay2')[0];
                            lightbox2.style.display = '';
                        },
                        error: function (res) {
                            console.log('not good');
                        },
                    });
                },
                close() {
                    let lightbox2 = document.querySelectorAll('.overlay2')[0];
                    lightbox2.style.display = 'none';
                },
            },
        });



        var app = new Vue({
            el: "#are",
            data: {
                artno: "",
                articlesRows: [],
            },

            methods: {
                addheart(arno) {
                    if (this.title == "add") {
                        $.ajax({
                            url: './phps/addArtFavorite.php', // 要傳送的頁面
                            type: "POST",
                            method: 'POST',
                            dataType: 'text',             // 回傳資料會是 json 格式
                            data: { arno },                 // 將表單資料用打包起來送出去
                            success: function (res) {       // 成功以後會執行這個方法
                                console.log('good');
                            },
                            error: function (res) {
                                console.log('not good');
                            },
                        });
                        this.title = "noadd"
                    } else if (this.title = "noadd") {
                        this.title = "add";
                        this.src = "./images/common/heart.png";
                        $.ajax({
                            url: './phps/deleteArtFav.php', // 要傳送的頁面
                            type: "POST",
                            method: 'POST',
                            dataType: 'text',             // 回傳資料會是 json 格式
                            data: { arno },                 // 將表單資料用打包起來送出去
                            success: function (res) {       // 成功以後會執行這個方法
                                console.log('good');
                            },
                            error: function (res) {
                                console.log('not good');
                            },
                        });
                    }
                },
                showBox: function (ART_NO) {
                    let lightbox = document.querySelectorAll('.overlay')[0];
                    lightbox.style.display = '';
                    this.artno = ART_NO;
                },
            },
            computed: {

            },
            mounted() {
                let articlesRows;
                //============去server端拿資料
                let xhr = new XMLHttpRequest();
                xhr.onload = function () {
                    app.articlesRows = JSON.parse(xhr.responseText);
                    console.log(app.articlesRows);
                }
                xhr.open("get", "./phps/getArticles.php", true);
                xhr.send(null);

                // =====filter=====
                $('.list').click(function () {
                    let value = $(this).attr('data-filter');
                    if (value == 'all') {
                        $('.article').removeClass('fil_none');
                    }
                    else {
                        $('.article').not('.' + value).addClass('fil_none');
                        $('.article').filter('.' + value).removeClass('fil_none');
                    }
                });

                // ======filter change
                $('.list').click(function () {
                    $(this).addClass('fit');
                    $('.list').not(this).removeClass('fit');
                });
            },
        });

    </script>
</body>

</html>